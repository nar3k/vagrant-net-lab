- name: vlans of the config
  blockinfile:
    path: ./config/{{inventory_hostname}}.conf
    marker: ""
    block: |
        {% if vlans is defined %}
        vlans {
        {% for layer in ['layer2','layer3'] %}
        {% if layer in vlans %}
        {% for non_grouped_vlan in ['interconnects','vteps','storages'] %}
        {% if non_grouped_vlan in vlans[layer] %}
        {% for vlan_name in vlans[layer][non_grouped_vlan] %}
           {{ vlan_name }} {
              vlan-id {{ etc_vlans_db[non_grouped_vlan][vlan_name] }};
        {% if layer in  ['layer3'] %}
              l3-interface {{ vlanif_interface }} .{{ etc_vlans_db[non_grouped_vlan][vlan_name] }};
        {% endif%}
          }
        {% endfor %}
        {% endif %}
        {% endfor %}
        {% for grouped_vlan in ['underlays','services'] %}
        {% if grouped_vlan in vlans[layer] %}
        {% for vlan_group in vlans[layer][grouped_vlan] %}
        {% for vlan_name,vlan_id in grouped_vlans_db[grouped_vlan][vlan_group].iteritems() %}
           {{ vlan_name }} {
              vlan-id {{ vlan_id }};
        {% if layer in  ['layer3'] %}
              l3-interface {{ vlanif_interface }} .{{ vlan_id }};
        {% endif%}
          }
        {% endfor %}
        {% endfor %}
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endfor %}
        }
        {% endif %}
