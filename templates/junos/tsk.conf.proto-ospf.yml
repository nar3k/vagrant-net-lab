- name: fabric_interfaces
  blockinfile:
    path: ./config/{{inventory_hostname}}.conf
    marker: ""
    block: |
      ospf {
          area {{ ospf_area }} {

              interface lo0.0 {
                  passive;
              }
        {% if ports.fabric_ports is defined %}
        {% for port in ports.fabric_ports %}
              interface {{port}}.0 {
                  interface-type p2p;
              }
        {% endfor %}
        {% endif %}
        {% if vlans is defined %}
        {% for vlan_group in vlans %}
        {% if vlan_group.layer in ['layer3'] %}
        {% for vlan_name in vlan_group['vlan_list'] %}
         interface {{ vlanif_definition }}.{{ network_db[vlan_name]['vlan'] }} {
           {% if vlan_group.type in ['interconnect'] %}
               interface-type p2p;
           {% elif vlan_group.type in ['service'] %}
                    passive;
           {% endif %}
                  }

        {% endfor %}
        {% endif %}
        {% endfor %}
        {% endif %}

          }
        }
