

- name: vlanif interfaces
  blockinfile:
    path: ./config/{{inventory_hostname}}.conf
    marker: ""
    block: |
         {% if vlans is defined %}
         {% for vlan_group in vlans %}
         {% if vlan_group['layer'] in ['layer3'] %}
         {% set ip = vlan_group['ip_number'] %}
         {% for vlan_name in vlan_group.vlan_list %}

         unit {{ network_db[vlan_name]['vlan'] }}{
           description {{ vlan_name }};
           family inet {

             address {{ network_db[vlan_name]['net'] | ipaddr(ip) }};

             }
         }
         {% endfor %}
         {% endif %}
         {% endfor %}
         {% endif %}
